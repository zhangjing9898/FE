# vuexç®€å•ä»‹ç»

å‰é¢å¯¹vueçš„æºç è¿›è¡Œäº†ç®€å•çš„è§£æï¼Œæ¥ä¸‹æ¥vuexçš„ç®€å•å‰–æä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬å¼€å‘çš„ä¸æ˜¯å•é¡µé¢çš„æ—¶å€™ï¼Œæˆ–è€…è¯´æ¶‰åŠçš„é¡¹ç›®æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œé€šè¿‡ç®€ç­”çš„çˆ¶å­ç»„ä»¶ä¹‹é—´å€¼çš„ä¼ é€’ï¼Œè¿™ç§åŠæ³•ä¸å¤ªç§‘å­¦ã€‚

æ‰€ä»¥éœ€è¦ä¸€ä¸ªå¤šç»„ä»¶çŠ¶æ€å…±äº«çš„ä¸œè¥¿ï¼Œç®€å•æ¥è¯´ï¼Œè¿™å°±æ˜¯vuexçš„ä½œç”¨ã€‚

### 1. vuexæ˜¯ä»€ä¹ˆ

- GitHubç«™ç‚¹ https://github.com/vuejs/vuex
- åœ¨çº¿æ–‡æ¡£: https://vuex.vuejs.org/zh-cn/
- ç®€å•æ¥è¯´ï¼Œå®ƒæ˜¯å¯¹åº”ç”¨ä¸­ç»„ä»¶çš„çŠ¶æ€è¿›è¡Œäº†é›†ä¸­å¼çš„ä¸€ä¸ªç®¡ç†(è¯»/å†™)

### 2. çŠ¶æ€è‡ªç®¡ç†åº”ç”¨

- state: é©±åŠ¨åº”ç”¨çš„æ•°æ®æº
- view: ä»¥å£°æ˜æ–¹å¼å°†stateæ˜ å°„åˆ°è§†å›¾ å£°æ˜æ–¹å¼ -> eg:{{count}}
- actions: å“åº”åœ¨viewä¸Šçš„ç”¨æˆ·è¾“å…¥å¯¼è‡´çš„çŠ¶æ€å˜åŒ–(åŒ…å«nä¸ªæ›´æ–°çŠ¶æ€çš„æ–¹æ³•) action->å‡½æ•°
![å•å‘æ•°æ®æµ](https://vuex.vuejs.org/flow.png)
- ä¸¾ä¸€ä¸ªä¾‹å­ğŸŒ°
  - ç‚¹å‡»ä¸€ä¸ªbuttonï¼ŒçŠ¶æ€æ”¹å˜åˆ°é¡µé¢æ”¹å˜çš„è¿‡ç¨‹ï¼š
  - view -> ç‚¹å‡» button -> éœ€è¦actionsä¸­çš„æ–¹æ³• -> æ–¹æ³•ç”¨äºæ”¹å˜å€¼ -> è¿›å…¥stateçŠ¶æ€ç®¡ç† -> æ”¹å˜stateä¸­çš„çŠ¶æ€ -> çŠ¶æ€æ”¹å˜åï¼Œviewæ›´æ–° 

### 3. å¤šç»„ä»¶å…±äº«çŠ¶æ€çš„problem

- å¤šä¸ªè§†å›¾ä¾èµ–åŒä¸€ä¸ªçŠ¶æ€
- æ¥è‡ªä¸åŒçš„è§†å›¾çš„è¡Œä¸º éœ€è¦å˜æ›´åŒä¸€ä¸ªçŠ¶æ€
- æ²¡æœ‰vuexçš„è§£å†³æ–¹æ³•
  - å°†æ•°æ®å’Œæ“ä½œæ•°æ®çš„è¡Œä¸ºéƒ½å®šä¹‰åœ¨çˆ¶ç»„ä»¶
  - å°†æ•°æ®å’Œæ“ä½œæ•°æ®çš„è¡Œä¸ºä¼ é€’ç»™éœ€è¦çš„å„ä¸ªå­ç»„ä»¶(æœ‰æ—¶å€™ä¼šå¤šçº§ä¼ é€’)

![](https://vuex.vuejs.org/vuex.png)

## vuexçš„åŸºç¡€æ¦‚å¿µ

ä¸‹é¢åˆ—ä¸¾ä¸€äº›vuexçš„åŸºç¡€æ¦‚å¿µ

### state

- vuexç®¡ç†çš„çŠ¶æ€ å®ƒæ˜¯ä¸€ä¸ª`å¯¹è±¡`
- å®ƒæ˜¯å”¯ä¸€çš„
- ä¾‹å­ğŸŒ°
  
```js
const state = {
  a: initValue
}
```

### mutations

- åŒ…å«å¤šä¸ª`ç›´æ¥æ›´æ–°`stateçš„æ–¹æ³• å®ƒä¹Ÿæ˜¯ä¸€ä¸ª`å¯¹è±¡`
- è°æ¥è§¦å‘ï¼Ÿ
  - actionä¸­çš„commit('mutationåç§°')
- åªèƒ½åŒ…å«åŒæ­¥çš„ä»£ç ï¼Œä¸èƒ½å†™å¼‚æ­¥
- ä¾‹å­ğŸŒ°
  
```js
const mutations = {
  xxx(state, data){
    // æ›´æ–°stateçš„æŸä¸ªå±æ€§
  }
}
```

### actions

- åŒ…å«å¤šä¸ªäº‹ä»¶å›è°ƒå‡½æ•° å®ƒä¹Ÿæ˜¯ä¸€ä¸ª`å¯¹è±¡`
- é€šè¿‡æ‰§è¡Œ commit()æ¥è§¦å‘mutationçš„è°ƒç”¨ é—´æ¥æ›´æ–°state
- å¦‚ä½•è§¦å‘ï¼Ÿ
  - ç»„ä»¶ä¸­ store.dispatch('actionåç§°)
- å¯ä»¥å¼‚æ­¥æ‰§è¡Œ(å®šæ—¶å™¨ï¼Œajax)
- ä¾‹å­ğŸŒ°

```js
const actions = {
  incrementAsync ({ commit }) {
    setTimeout(() => {
      commit('increment')
    }, 1000)
  }
}
```

### getters

- åŒ…å«å¤šä¸ªè®¡ç®—å±æ€§(get) åŒç† ä¹Ÿæ˜¯ä¸€ä¸ª`å¯¹è±¡`
- å¦‚ä½•è¯»å–ï¼Ÿ
  - store.getters.doneTodosCount
- ä¾‹å­ğŸŒ°

```JS
const getters = {
  doneTodosCount: (state, getters) => {
    return getters.doneTodos.length
  }
}
```

### modules 

- åŒ…å«å¤šä¸ªmodule
- ä¸€ä¸ªmoduleæ˜¯ä¸€ä¸ªstoreçš„é…ç½®å¯¹è±¡

### å‘å¤–æš´éœ²storeå¯¹è±¡

```js
export default new Vuex.store({
  state,
  mutations,
  getters,
  actions
})
```

### ç»„ä»¶å†…

```js
import {mapGetters, mapActions} from 'vuex';
export default {
  computed: mapGetters(['aaa']);
  methods: mapActions(['bbb']);
}
```

### æ˜ å°„store

```js
import store from './store';
new Vue({
  store
})
```
### storeå¯¹è±¡

- æ‰€æœ‰ç”¨vuexç®¡ç†çš„ç»„ä»¶ä¸­éƒ½å¤šäº†ä¸€ä¸ªå±æ€§$store, å®ƒå°±æ˜¯ä¸€ä¸ªstoreå¯¹è±¡
- å±æ€§:
  - state: æ³¨å†Œçš„stateå¯¹è±¡
  - getters: æ³¨å†Œçš„getterså¯¹è±¡
- æ–¹æ³•:
	- dispatch(actionName, data): åˆ†å‘è°ƒç”¨action
